name: Build DEB Package

on:
  release:
    types: [created]

jobs:
  build-deb:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout repository
      - name: Checkout
        uses: actions/checkout@v3

      # 2. Install build dependencies
      - name: Install dependencies
        run: sudo apt-get update && sudo apt-get install -y devscripts debhelper fakeroot

      # 3. Prepare package structure
      - name: Prepare package structure
        run: |
          mkdir -p package/usr/local/bin
          mkdir -p package/usr/share/applications
          mkdir -p package/usr/share/icons/hicolor/scalable/apps
          cp src/mint-cleaner.sh package/usr/local/bin/mint-cleaner
          cp desktop/mint-cleaner.desktop package/usr/share/applications/mint-cleaner.desktop
          cp icons/system-cleaner.svg package/usr/share/icons/hicolor/scalable/apps/system-cleaner.svg
          mkdir -p package/DEBIAN
          cp debian/postinst package/DEBIAN/postinst
          cp debian/prerm package/DEBIAN/prerm
          chmod 755 package/DEBIAN/postinst package/DEBIAN/prerm

      # 4. Create DEBIAN control file
      - name: Create DEBIAN control file
        run: |
          cat <<EOF > package/DEBIAN/control
          Package: linux-mint-cleaner
          Version: ${{ github.event.release.tag_name }}
          Section: utils
          Priority: optional
          Architecture: all
          Maintainer: skyss0fly <skyss0flypersonal@gmail.com>
          Description: Linux Mint Cleaner â€” safe system cleaner for Linux Mint
          EOF

      # 5. Build the .deb package
      - name: Build DEB
        run: dpkg-deb --build package linux-mint-cleaner.deb

      # 6. Upload to GitHub Release
      - name: Upload .deb to release
        uses: softprops/action-gh-release@v1
        with:
          files: linux-mint-cleaner.deb
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
